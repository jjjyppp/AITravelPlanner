# 语音识别调试指南

## 🔍 调试步骤

现在语音识别功能已经添加了详细的日志输出，请按照以下步骤进行调试：

### 1. 打开浏览器开发者工具

1. 按 `F12` 或右键点击页面选择"检查"
2. 切换到 `Console` 标签页
3. 清空控制台日志（点击清空按钮）

### 2. 测试语音识别功能

1. 访问 `http://localhost:5173/realtime-demo`
2. 点击"连接并开始录音"按钮
3. 观察控制台输出的日志

### 3. 关键日志说明

#### 🔗 连接阶段
```
🔗 开始连接WebSocket...
🔗 鉴权URL生成成功: wss://iat-api.xfyun.cn/v2/iat?...
✅ WebSocket连接已建立
```

#### 🎙️ 录音阶段
```
🎙️ 开始录音流程...
🎤 请求麦克风权限...
✅ 麦克风权限获取成功
🔊 创建AudioContext...
✅ AudioContext创建成功，采样率: 16000
🎵 音频源创建成功
⚙️ ScriptProcessorNode创建成功，缓冲区大小: 4096
🔗 音频处理链连接完成
⏰ 音频传输定时器启动
📤 发送第一帧建立会话: {...}
✅ 第一帧发送完成
✅ 录音开始成功
```

#### 📨 消息接收阶段
```
📨 收到WebSocket消息: {...}
🔍 解析WebSocket消息...
📋 解析后的消息: {...}
🆔 会话ID: ...
🎯 处理识别结果...
📝 识别结果详情: {...}
📄 提取的文本: "你好"
🔄 动态修正状态: {isReplace: false, pgs: undefined}
📤 调用onResult回调: {text: "你好", isReplace: false}
🎯 语音识别组件收到结果: {text: "你好", isReplace: false}
➕ 追加模式，追加文本: 你好 当前结果: 你好
📤 调用外部onResult回调: 你好
```

### 4. 常见问题诊断

#### 问题1: 连接失败
**症状**: 看到 `❌ WebSocket错误` 或 `❌ 连接失败`
**可能原因**:
- 网络连接问题
- API密钥错误
- 鉴权URL生成失败

**解决方案**:
- 检查网络连接
- 验证API密钥配置
- 查看鉴权URL是否正确

#### 问题2: 麦克风权限被拒绝
**症状**: 看到 `❌ 开始录音失败: NotAllowedError`
**可能原因**:
- 用户拒绝了麦克风权限
- 浏览器不支持getUserMedia
- 非HTTPS环境

**解决方案**:
- 确保使用HTTPS
- 重新授权麦克风权限
- 检查浏览器兼容性

#### 问题3: 没有识别结果
**症状**: 录音正常但没有识别结果
**可能原因**:
- WebSocket连接断开
- 音频数据格式问题
- API返回错误

**解决方案**:
- 检查WebSocket连接状态
- 查看音频数据发送日志
- 检查API返回的错误信息

#### 问题4: 识别结果为空
**症状**: 看到 `⚠️ 识别结果为空文本`
**可能原因**:
- 说话声音太小
- 环境噪音太大
- 语言设置不匹配

**解决方案**:
- 提高说话音量
- 在安静环境中测试
- 检查语言设置

### 5. 调试技巧

#### 查看完整日志
1. 在控制台中右键点击日志
2. 选择"保存为..."保存日志文件
3. 分享日志文件以便分析

#### 过滤日志
1. 在控制台搜索框中输入关键词
2. 例如搜索 "❌" 查看所有错误
3. 搜索 "🎯" 查看识别结果

#### 实时监控
1. 保持控制台打开
2. 观察日志的实时输出
3. 注意错误和警告信息

### 6. 日志级别说明

- 🔗 **连接相关**: WebSocket连接和鉴权
- 🎙️ **录音相关**: 麦克风权限和音频处理
- 📨 **消息相关**: WebSocket消息收发
- 🎯 **识别相关**: 语音识别结果处理
- ❌ **错误信息**: 各种错误和异常
- ✅ **成功信息**: 操作成功确认
- ⚠️ **警告信息**: 需要注意的问题

### 7. 测试建议

#### 基础测试
1. 先测试连接是否成功
2. 再测试麦克风权限是否获取
3. 最后测试语音识别是否工作

#### 环境测试
1. 在安静环境中测试
2. 说话清晰，音量适中
3. 使用中文普通话

#### 网络测试
1. 确保网络连接稳定
2. 检查防火墙设置
3. 尝试不同的网络环境

### 8. 常见错误码

- **10165**: invalid handle - 第一帧音频状态错误
- **10001**: 参数错误
- **10002**: 签名验证失败
- **10003**: 访问频率超限
- **10004**: 访问IP不在白名单

### 9. 联系支持

如果问题仍然存在，请提供：
1. 完整的控制台日志
2. 浏览器版本和操作系统
3. 网络环境描述
4. 复现步骤

---

通过这个详细的日志系统，您可以准确定位语音识别功能的问题所在，快速解决各种技术问题。
